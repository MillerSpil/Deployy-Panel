services:
  deployy-panel:
    build: .
    image: deployy-panel
    container_name: deployy-panel
    ports:
      - "3000:3000"
      # Minecraft â€” add more ports for additional servers (e.g. 25566:25566)
      - "25565:25565"
      # Hytale (QUIC over UDP)
      - "5520:5520/udp"
    volumes:
      - ./data:/data
      - ./servers:/opt/deployy-servers
    environment:
      - NODE_ENV=production
      - DATABASE_URL=file:/data/deployy.db
      - SERVERS_BASE_PATH=/opt/deployy-servers
      - DOCKER_CONTAINER=true
    env_file:
      - .env
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "node", "-e", "fetch('http://localhost:3000/health').then(r => { if (!r.ok) process.exit(1) }).catch(() => process.exit(1))"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    deploy:
      resources:
        limits:
          cpus: "4"
          memory: 4G
        reservations:
          cpus: "1"
          memory: 512M
